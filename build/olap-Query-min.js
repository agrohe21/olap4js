olap.Query=function(t,n){var r,i,s,o,u;n instanceof Object&&(n instanceof olap.Cube?this.cube=n:this.cube=new olap.Cube(n)),this.axes=[],this.hierarchies=[];if(!this.cube instanceof olap.Cube)throw new Error("Unable to create query: invalid cube");s=this.cube.getHierarchies();for(var a=0,f=s.length;a<f;a++)o=s[a],u=new olap.QueryHierarchy(this,o),this.hierarchies[u.getName()]=u;this.id=olap.Query.id++,this.name=t||"query"+this.id,olap.Query.instances[this.id]=this},olap.Query.id=1,olap.Query.prefix="olap.query",olap.Query.instances={},olap.Query.getInstance=function(e){return olap.Query.instances[e]},olap.Query.prototype={addAxis:function(t){t instanceof Object&&t instanceof olap.Axis==0&&(t=new olap.Axis(t,this)),t instanceof olap.Axis&&this.axes.push(t)},getAxes:function(){return this.axes.length==0&&this.fetchAxes(),this.axes},fetchAxes:function(){},getAxis:function(t){return this.axes.length==0&&this.fetchAxes(),this.axes[t]},getCube:function(){return this.cube},getName:function(){return this.name},createAxis:function(t){var t=new olap.QueryAxis(this,t);return this.axes.push(t),t},getHierarchy:function(t){return t instanceof olap.Hierarchy?this.hierarchies[t.getName()]:this.hierarchies[t]},getMDX:function(){var t="",n=this.getAxes(),r,i;for(var s=0,o=n.length;s<o;s++)i=this.getAxis(s).getMdx(),t+=" "+i;return t.length&&(t="SELECT"+t+"\nFROM   ["+this.getCube().getName()+"]"),console.debug(t),t},execute:function(t){var n=this.results||new olap.CellSet({});if(typeof t!="function")return n;t.call(this,n),delete n}};
