<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>OLAP4JS: Query Model Test</title>
    </head>
    <body>
        <h1>OLAP Xmla Query Model Testing</h1>
        <script src="../src/olap.js"></script>
        <script src="../samples/Xmla.js"></script>
        <script src="../src/olap-xmla.js"></script>
        <script src="../src/olap-Query.js"></script>
        <script src="../src/olap-QueryAxis.js"></script>
        <script src="../src/olap-QueryHierarchy.js"></script>
        <script src="../src/olap-QueryLevel.js"></script>
	<script src="../lib/yui/yui/yui-min.js"></script>	
        <script type="text/javascript" src="../samples/prettyprint.js"></script>
        <script type="text/javascript">

	var getCubeByName = function (catalogName, cubeName) {
	    var olapConn = new olapXmla.Connection(), cubes, cube = {};
		//get all cubes for active connection
		cubes = olapConn.getCubes();
		//filter cubes array down to only CATALOG_NAME = SteelWheels
		cubes = filterProperty.apply(cubes, [{type:'equal', property:'CATALOG_NAME', value:catalogName}]);
		cube = filterProperty.apply(cubes, [{type:'equal', property:'CUBE_NAME',    value:cubeName}]);
		return cube;
	}
        
		YUI({ logInclude: { TestRunner: true } }).use('test', 'JSON', 'json', function (Y) {
		//YUI().use('test', function (Y) {

		    var suite = new Y.Test.Suite("Test of olap4js Query Objects");
		    var cube = getCubeByName("SteelWheels", "SteelWheelsSales");
		    var qry = new olap.Query("test", cube);
		    var testCase1 = new Y.Test.Case({
			name: "Create basic query",
			setUp : function () {
			    this.qry = qry;
			    var qa = this.qry.createAxis(0);
			    var products = this.qry.getHierarchy("Product");
			    qa.addHierarchy(products);
			},
			tearDown: function() {
			    delete this.qry;
			},
			testName: function () {
			    Y.Assert.areEqual('test', this.qry.getName());
			},
			testCubeName: function () {
			    var _cube = this.qry.getCube();
			    //Y.Assert.isInstanceOf(olap.Cube, _cube)
			    Y.Assert.areEqual("SteelWheelsSales", cube.getName());
			},
			testHierarchyName: function () {
			    var qa = this.qry.getAxis(0);
			    Y.Assert.isInstanceOf(olap.QueryAxis, qa)
			},
			testHierarchyCount: function () {
			    var qa = this.qry.getAxis(0);
			    Y.Assert.areEqual(1, qa.getQueryHierarchies().length)
			},
			testLevelCount: function () {
			    var qa = this.qry.getAxis(0);
			    var qh = qa.getQueryHierarchies()[0];
			    Y.Assert.areEqual(4, qh.queryLevels.length)
			}
		    });
		    suite.add(testCase1);	    

		    var testCase2 = new Y.Test.Case({
			name: "Create basic query",
			setUp : function () {
			    this.qry = qry;
			    var qa = this.qry.createAxis(0);
			    var products = this.qry.getHierarchy("Product");
                            products.includeLevel("Product Family");
			    qa.addHierarchy(products);
			},
			tearDown: function() {
			    delete this.qry;
			},
			testName: function () {
			    //Y.Assert.areEqual('test', this.qry.getName());
			}
		    });
		    suite.add(testCase2);	    
		      
		    //add the test cases and suites
		    Y.Test.Runner.add(suite);
		    var getResults = function(){
			    //get object of results
			    resultsObject = Y.Test.Runner.getResults();
			    document.body.appendChild(prettyPrint(resultsObject, { maxDepth:10 } ));
		    }
		    Y.Test.TestRunner.subscribe(Y.Test.TestRunner.COMPLETE_EVENT, getResults);			
		    
		    //run all tests
		    Y.Test.Runner.run();
		});
        </script>
    </body>
</html>
